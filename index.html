<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moduláris Angoltanító</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <h1>Moduláris Angoltanító</h1>

        <div class="module-selector">
            <label for="moduleSelect">Válassz modult:</label>
            <select id="moduleSelect"></select>
            <button id="startModuleBtn" class="start-btn">Indítás</button>
        </div>

        <div id="moduleDescription" class="description"></div>
        <div id="quizContainer" class="quiz-container"></div>
    </div>

    <script>
        async function loadModules() {
            try {
                const res = await fetch('modules/manifest.json');
                const manifest = await res.json();
                const select = document.getElementById('moduleSelect');

                select.innerHTML = '';

                manifest.forEach(module => {
                    const option = document.createElement('option');
                    option.value = module.file;
                    option.textContent = module.name;
                    option.dataset.description = module.description || '';
                    select.appendChild(option);
                });

                if (manifest.length > 0) {
                    document.getElementById('moduleDescription').textContent =
                        manifest[0].description || '';
                }
            } catch (err) {
                console.error("Hiba a modulok betöltésekor:", err);
            }
        }

        document.getElementById('moduleSelect').addEventListener('change', function () {
            const desc = this.options[this.selectedIndex].dataset.description || '';
            document.getElementById('moduleDescription').textContent = desc;
        });

        document.getElementById('startModuleBtn').addEventListener('click', async function () {
            const select = document.getElementById('moduleSelect');
            const selectedFile = select.value;

            if (!selectedFile) {
                alert("Válassz ki egy modult az indításhoz!");
                return;
            }

            try {
                const res = await fetch(`modules/${selectedFile}`);
                const moduleData = await res.json();

                renderQuiz(moduleData);
            } catch (err) {
                console.error("Hiba a modul betöltésekor:", err);
            }
        });

        function renderQuiz(questions) {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';

            questions.forEach((q, idx) => {
                const qDiv = document.createElement('div');
                qDiv.classList.add('question');

                const qText = document.createElement('p');
                qText.textContent = `${idx + 1}. ${q.prompt}`;
                qDiv.appendChild(qText);

                if (q.type === 'mcq' && q.options) {
                    q.options.forEach(opt => {
                        const btn = document.createElement('button');
                        btn.classList.add('answer-btn');
                        btn.textContent = opt;
                        btn.addEventListener('click', () => {
                            if (opt === q.answer) {
                                alert("Helyes!");
                            } else {
                                alert(`Helytelen! Helyes válasz: ${q.answer}`);
                            }
                        });
                        qDiv.appendChild(btn);
                    });
                } else if (q.type === 'fill') {
                    const input = document.createElement('input');
                    input.placeholder = q.placeholder || 'Írd ide a választ';
                    const checkBtn = document.createElement('button');
                    checkBtn.textContent = "Ellenőrzés";
                    checkBtn.classList.add('check-btn');
                    checkBtn.addEventListener('click', () => {
                        if (input.value.trim().toLowerCase() === q.answer.toLowerCase()) {
                            alert("Helyes!");
                        } else {
                            alert(`Helytelen! Helyes válasz: ${q.answer}`);
                        }
                    });
                    qDiv.appendChild(input);
                    qDiv.appendChild(checkBtn);
                }

                container.appendChild(qDiv);
            });
        }

        loadModules();
    </script>
</body>
</html>
